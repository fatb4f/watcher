#!/usr/bin/env bash
set -euo pipefail

if command -v systemd-tui >/dev/null 2>&1; then
  exec systemd-tui
fi

if command -v btop >/dev/null 2>&1; then
  exec btop
fi

if command -v bottom >/dev/null 2>&1; then
  exec bottom
fi

while true; do
  clear
  printf "watchctl control dashboard fallback\n\n"
  printf "time: %s\n\n" "$(date -u +%Y-%m-%dT%H:%M:%SZ)"
  systemctl --user --no-pager --full status \
    watchctl-codex-session-refresh.service \
    watchctl-system-security-package.service || true
  printf "\nlast watcher events:\n"
  tail -n 20 "$HOME/.local/state/codex/watcher/watchctl-events.jsonl" 2>/dev/null || true
  sleep 5
done
